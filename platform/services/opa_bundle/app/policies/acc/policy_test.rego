# INTEL CONFIDENTIAL
#
# Copyright (C) 2023 Intel Corporation
#
# This software and the related documents are Intel copyrighted materials, and your use of them is governed by
# the express license under which they were provided to you ("License"). Unless the License provides otherwise,
# you may not use, modify, copy, publish, distribute, disclose or transmit this software or the related documents
# without Intel's prior written permission.
#
# This software and the related documents are provided as is, with no express or implied warranties,
# other than those that are expressly stated in the License.

package istio.authz

import future.keywords
import future.keywords.every
import input.attributes.request.http as http_request
import input.parsed_path
import input.parsed_query

test_result_license_valid {
    result == {"allowed": true, "body": ""}
    with allow as true
    with is_license_valid as true
}

test_result_license_invalid_not_allow {
    result == {"allowed": false, "body": "License is invalid."}
    with input as {
        "attributes": {"request": {"http": {
            "method": "GET",
            "path": "/api/v1/organizations/",
        }}},
        "parsed_path": ["api", "v1", "workspaces"]
        }
    with is_license_valid as false
}

test_result_health_route_and_license_invalid {
    result == {"allowed": true, "body": ""}
    with input as {
        "attributes": {"request": {"http": {
            "method": "GET",
            "path": "/health/",
        }}},
        "parsed_path": [
            "health",
            "",
        ],
    }
    with is_license_valid as false
}

test_health_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
            "method": "GET",
            "path": "/health/",
        }}},
        "parsed_path": [
            "health",
            "",
        ],
    }
}

test_license_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
            "method": "GET",
            "path": "/api/v1/license/valid",
        }}},
        "parsed_path": ["api","v1","license","valid"],
    }
}

test_license_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
            "method": "POST",
            "path": "/api/v1/license/valid",
        }}},
        "parsed_path": ["api","v1","license","valid"],
    }
}

test_organizations_SaaS_admin_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
            "path": "/api/v1/organizations",
            "headers": {"x-auth-request-access-token": "eyJhbGciOiJub25lIn0.eyJpc3MiOiJodHRwczovLzEwLjU1LjI1Mi4xMDEvZGV4Iiwic3ViIjoiQ2lSamJqMTFhV1JBWlhoaGJYQnNaUzV2Y21jc1pHTTlaWGhoYlhCc1pTeGtZejF2Y21jU0RYSmxaM1ZzWVhKZmRYTmxjbk0iLCJhdWQiOiJmd0NEWEs1dXNWT2hKaHlJWWpnaCIsImV4cCI6MTY4NTUzODg3OCwiaWF0IjoxNjg1NTM4ODc4LCJhdF9oYXNoIjoibUtxbWN2NzF3ZDl2Q0FSRWZURUR1dyIsImVtYWlsIjoibWFpbEBleGFtcGxlLm9yZyIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoidWlkQGV4YW1wbGUub3JnIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiIn0."},
        }}},
        "parsed_path": ["api", "v1", "organizations"],
    } with is_license_valid as true
}

test_organizations_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
            "path": "/api/v1/organizations",
        }}},
        "parsed_path": ["api", "v1", "organizations"],
    } with is_license_valid as true
}

test_organizations_invitations_SaaS_admin_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"method": "POST",
            "headers": {"x-auth-request-access-token": "eyJhbGciOiJub25lIn0.eyJpc3MiOiJodHRwczovLzEwLjU1LjI1Mi4xMDEvZGV4Iiwic3ViIjoiQ2lSamJqMTFhV1JBWlhoaGJYQnNaUzV2Y21jc1pHTTlaWGhoYlhCc1pTeGtZejF2Y21jU0RYSmxaM1ZzWVhKZmRYTmxjbk0iLCJhdWQiOiJmd0NEWEs1dXNWT2hKaHlJWWpnaCIsImV4cCI6MTY4NTUzODg3OCwiaWF0IjoxNjg1NTM4ODc4LCJhdF9oYXNoIjoibUtxbWN2NzF3ZDl2Q0FSRWZURUR1dyIsImVtYWlsIjoibWFpbEBleGFtcGxlLm9yZyIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoidWlkQGV4YW1wbGUub3JnIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiIn0."},
            "path": "/api/v1/organizations/invitations",
        }}},
        "parsed_path": ["api", "v1", "organizations", "invitations"],
    } with is_license_valid as true
}

test_organizations_invitations_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "POST",
            "path": "/api/v1/organizations/invitations",
        }}},
        "parsed_path": ["api", "v1", "organizations", "invitations"],
    } with is_license_valid as true
}

test_organizations_org_id_admin_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"method": "PUT",
            "headers": {"x-auth-request-access-token": "eyJhbGciOiJub25lIn0.eyJpc3MiOiJodHRwczovLzEwLjU1LjI1Mi4xMDEvZGV4Iiwic3ViIjoiQ2lSamJqMTFhV1JBWlhoaGJYQnNaUzV2Y21jc1pHTTlaWGhoYlhCc1pTeGtZejF2Y21jU0RYSmxaM1ZzWVhKZmRYTmxjbk0iLCJhdWQiOiJmd0NEWEs1dXNWT2hKaHlJWWpnaCIsImV4cCI6MTY4NTUzODg3OCwiaWF0IjoxNjg1NTM4ODc4LCJhdF9oYXNoIjoibUtxbWN2NzF3ZDl2Q0FSRWZURUR1dyIsImVtYWlsIjoibWFpbEBleGFtcGxlLm9yZyIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoidWlkQGV4YW1wbGUub3JnIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiIn0."},
            "path": "/api/v1/organizations/1",
        }}},
        "parsed_path": ["api", "v1", "organizations", 1],
    } with is_license_valid as true
}

test_organizations_org_id_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "PUT",
            "path": "/api/v1/organizations/1",
        }}},
        "parsed_path": ["api", "v1", "organizations", 1],
    } with is_license_valid as true

}

test_organizations_org_id_statuses_admin_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"method": "PUT",
            "headers": {"x-auth-request-access-token": "eyJhbGciOiJub25lIn0.eyJpc3MiOiJodHRwczovLzEwLjU1LjI1Mi4xMDEvZGV4Iiwic3ViIjoiQ2lSamJqMTFhV1JBWlhoaGJYQnNaUzV2Y21jc1pHTTlaWGhoYlhCc1pTeGtZejF2Y21jU0RYSmxaM1ZzWVhKZmRYTmxjbk0iLCJhdWQiOiJmd0NEWEs1dXNWT2hKaHlJWWpnaCIsImV4cCI6MTY4NTUzODg3OCwiaWF0IjoxNjg1NTM4ODc4LCJhdF9oYXNoIjoibUtxbWN2NzF3ZDl2Q0FSRWZURUR1dyIsImVtYWlsIjoibWFpbEBleGFtcGxlLm9yZyIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoidWlkQGV4YW1wbGUub3JnIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiIn0."},
            "path": "/api/v1/organizations/1/statuses",
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "statuses"],
    } with is_license_valid as true
}

test_organizations_org_id_statuses_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "PUT",
            "path": "/api/v1/organizations/1/statuses",
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "statuses"],
    } with is_license_valid as true

}

test_organizations_org_id_users_admin_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"method": "GET",
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJub25lIn0.eyJpc3MiOiJodHRwczovLzEwLjU1LjI1Mi4xMDEvZGV4Iiwic3ViIjoiQ2lSamJqMTFhV1JBWlhoaGJYQnNaUzV2Y21jc1pHTTlaWGhoYlhCc1pTeGtZejF2Y21jU0RYSmxaM1ZzWVhKZmRYTmxjbk0iLCJhdWQiOiJmd0NEWEs1dXNWT2hKaHlJWWpnaCIsImV4cCI6MTY4NTUzODg3OCwiaWF0IjoxNjg1NTM4ODc4LCJhdF9oYXNoIjoibUtxbWN2NzF3ZDl2Q0FSRWZURUR1dyIsImVtYWlsIjoibWFpbEBleGFtcGxlLm9yZyIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoidWlkQGV4YW1wbGUub3JnIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiIn0."},
            "path": "/api/v1/organizations/1/users",
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users"],
    } with is_license_valid as true
}

test_organizations_org_id_users_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1/users",
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users"],
    } with is_license_valid as true

}

test_organizations_org_id_user_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"method": "GET",
            "headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
            "path": "/api/v1/organizations/1/users",
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users"],
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_user_resourceId_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"method": "GET",
            "headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
            "path": "/api/v1/organizations/1/users",
            "query": "resourceId=1"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users"],
        "parsed_query": {"resourceId": ["1"]}
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_not_org_user_resourceId_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"method": "GET",
            "headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
            "path": "/api/v1/organizations/1/users",
            "query": "resourceId=1"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users"],
        "parsed_query": {"resourceId": ["1"]}
    } with is_license_valid as true
with check_authorization_spicedb as false
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_not_org_user_resourceId_resourceType_project_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"method": "GET",
            "headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
            "path": "/api/v1/organizations/1/users",
            "query": "resourceId=1&resourceType=project"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users"],
        "parsed_query": {"resourceId": ["1"], "resourceType": ["project"]}
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_not_org_user_resourceId_resourceType_workspace_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"method": "GET",
            "headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
            "path": "/api/v1/organizations/1/users",
            "query": "resourceId=1&resourceType=workspace"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users"],
        "parsed_query": {"resourceId": ["1"], "resourceType": ["workspace"]}
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_not_org_user_resourceId_resourceType_project_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"method": "GET",
            "headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
            "path": "/api/v1/organizations/1/users",
            "query": "resourceId=1&resourceType=project"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users"],
        "parsed_query": {"resourceId": ["1"], "resourceType": ["project"]}
    } with is_license_valid as true
with check_authorization_spicedb as false
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_not_org_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1/users",
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users"],
    } with is_license_valid as true
}

test_organizations_org_id_not_org_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1",
        }}},
        "parsed_path": ["api", "v1", "organizations", 1],
    } with is_license_valid as true
with check_authorization_spicedb as false
with spicedb_key as "token"
with spicedb_address as "localhost"
}

test_organizations_org_id_workspace_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1/workspaces"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "workspaces"],
    } with is_license_valid as true
with check_authorization_spicedb as false
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_workspace_id_user_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1/workspaces/1"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "workspaces", 1],
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_workspace_id_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1/workspaces/1"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "workspaces", 1],
    } with is_license_valid as true
with check_authorization_spicedb as false
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_user_id_users_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1/users"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users"],
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_user_id_users_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1/users"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users"],
    } with is_license_valid as true
with check_authorization_spicedb as false
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_user_id_user_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "PUT",
            "path": "/api/v1/organizations/1/users/1"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users", 1],
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_user_id_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "PUT",
            "path": "/api/v1/organizations/1/users/1"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users", 1],
    } with is_license_valid as true
with check_authorization_spicedb as false
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_invitations_user_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "POST",
            "path": "/api/v1/organizations/1/users/invitations",
            "body": "{\"roles\":[{\"role\":{\"resourceId\":\"1\",\"role\":\"workspace_contributor\",\"resourceType\":\"workspace\"},\"operation\":\"CREATE\"}, {\"role\":{\"resourceId\":\"1\",\"role\":\"organization_contributor\",\"resourceType\":\"organization\"},\"operation\":\"CREATE\"}]}"
        }}},
        "parsed_path": ["api", "v1", "organizations", "1", "users", "invitations"],
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
with check_relation as true
with is_valid_api_version as true
with check_if_objects_are_related_user_invitation as true
}

test_organizations_org_id_invitations_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "POST",
            "path": "/api/v1/organizations/1/users/invitations"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users", "invitations"],
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
with check_relation as true
with is_valid_api_version as true
with check_if_objects_are_related_user_invitation as true
}

test_organizations_org_id_invitations_user_multi_role_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "POST",
            "path": "/api/v1/organizations/1/users/invitations",
            "body": "{\"roles\":[{\"role\":{\"resourceId\":\"1\",\"role\":\"workspace_contributor\",\"resourceType\":\"workspace\"},\"operation\":\"CREATE\"}, {\"role\":{\"resourceId\":\"1\",\"role\":\"organization_contributor\",\"resourceType\":\"organization\"},\"operation\":\"CREATE\"},{\"roles\":[{\"role\":{\"resourceId\":\"2\",\"role\":\"workspace_contributor\",\"resourceType\":\"workspace\"},\"operation\":\"CREATE\"}]}"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users", "invitations"],
    } with is_license_valid as true
with check_authorization_spicedb as false
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_user_id_roles_user_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1/users/1/roles",
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users", "1", "roles"],
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_user_id_roles_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "PUT",
            "path": "/api/v1/organizations/1/users/1/roles"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users", 1, "roles"],
    } with is_license_valid as true
with check_authorization_spicedb as false
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_user_id_active_user_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1/activeUser"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "activeUser"],
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_user_id_active_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1/activeUser"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "activeUser"],
    } with is_license_valid as true
with check_authorization_spicedb as false
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_profile_active_user_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/profile"
        }}},
        "parsed_path": ["api", "v1", "profile"],
    } with is_license_valid as true
}

test_organizations_org_id_user_id_statuses_user_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "PUT",
            "path": "/api/v1/organizations/1/users/1/statuses"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users", 1, "statuses"],
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_user_id_statuses_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "PUT",
            "path": "/api/v1/organizations/1/users/1/statuses"
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users", 1, "statuses"],
    } with is_license_valid as true
with check_authorization_spicedb as false
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_profile_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "POST",
            "path": "/api/v1/profile"
        }}},
        "parsed_path": ["api", "v1", "profile"],
    }
}

test_organizations_org_id_user_id_photos_user_allowed {
    allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1/users/51e63bb9-4324-487a-a680-e439540ac82e/photos",
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "photos"],
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
}

test_organizations_org_id_user_id_photos_user_not_allowed {
    not allow with input as {
        "attributes": {"request": {"http": {
        	"headers": {"x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"},
        	"method": "GET",
            "path": "/api/v1/organizations/1/users/1/photos",
        }}},
        "parsed_path": ["api", "v1", "organizations", 1, "users", "1", "photos"],
    } with is_license_valid as true
with check_authorization_spicedb as true
with spicedb_key as "key"
with spicedb_address as "localhost"
}

# Test access to GET /api/v1/organizations/<org_id>/users/<users_id>/personal_access_tokens endpoint to organization_admin for user that is in organization
test_get_personal_access_tokens_allowed_for_organization_admin {
    allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens"],
        "attributes": {
            "request": {
                "http": {
                    "method": "GET",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
    with check_authorization_spicedb as true
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

test_get_personal_access_tokens_fails_on_invalid_license {
    not allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens"],
        "attributes": {
            "request": {
                "http": {
                    "method": "GET",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as false
    with check_authorization_spicedb as true
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

test_get_personal_access_tokens_fails_on_invalid_organization_for_organization_admin {
    not allow with input as {
        "parsed_path": ["api", "v1", "organizations", 10, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens"],
        "attributes": {
            "request": {
                "http": {
                    "method": "GET",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
    with check_authorization_spicedb as false
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

# Test access to POST /api/v1/organizations/<org_id>/users/<users_id>/personal_access_tokens endpoint to organization_admin for user that is in organization
test_post_personal_access_tokens_allowed_for_organization_admin {
    allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens"],
        "attributes": {
            "request": {
                "http": {
                    "method": "POST",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
    with check_authorization_spicedb as true
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

test_post_personal_access_tokens_fails_on_invalid_license {
    not allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens"],
        "attributes": {
            "request": {
                "http": {
                    "method": "POST",
                }
            }
        },
    }
    with is_license_valid as false
    with check_authorization_spicedb as true
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

test_post_personal_access_tokens_fails_on_invalid_organization_for_organization_admin {
    not allow with input as {
        "parsed_path": ["api", "v1", "organizations", 10, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens"],
        "attributes": {
            "request": {
                "http": {
                    "method": "POST",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
    with check_authorization_spicedb as false
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

# Unable to test access to GET, POST /api/v1/organizations/<org_id>/users/<users_id>/personal_access_tokens endpoint to self user in organization

# Test access to DELETE /api/v1/organizations/<org_id>/users/<users_id>/personal_access_tokens/<token_id> endpoint to self user in organization
test_delete_personal_access_tokens_allowed_for_self {
    allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens", "token_id"],
        "attributes": {
            "request": {
                "http": {
                    "method": "DELETE",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
    with check_user_identity as true
    with check_relation as true
    with check_authorization_spicedb as true
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

test_delete_personal_access_tokens_for_self_fails_on_invalid_license {
    not allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens", "token_id"],
        "attributes": {
            "request": {
                "http": {
                    "method": "DELETE",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as false
    with check_user_identity as true
    with check_relation as true
    with check_authorization_spicedb as true
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

test_delete_personal_access_tokens_for_self_fails_on_different_user {
    not allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens", "token_id"],
        "attributes": {
            "request": {
                "http": {
                    "method": "DELETE",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
    with check_user_identity as false
    with check_relation as true
    with check_authorization_spicedb as true
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

test_delete_personal_access_tokens_for_self_fails_on_key_of_another_user {
    not allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens", "token_id"],
        "attributes": {
            "request": {
                "http": {
                    "method": "DELETE",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
    with check_user_identity as true
    with check_relation as false
    with check_authorization_spicedb as true
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

test_delete_personal_access_tokens_for_self_fails_when_cant_contribute {
    not allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens", "token_id"],
        "attributes": {
            "request": {
                "http": {
                    "method": "DELETE",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
    with check_user_identity as true
    with check_relation as true
    with check_authorization_spicedb as false
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

# Test access to PATCH /api/v1/organizations/<org_id>/users/<users_id>/personal_access_tokens/<token_id> endpoint to self user in organization
test_patch_personal_access_tokens_allowed_for_self {
    allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens", "token_id"],
        "attributes": {
            "request": {
                "http": {
                    "method": "PATCH",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
    with check_user_identity as true
    with check_relation as true
    with check_authorization_spicedb as true
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

test_patch_personal_access_tokens_for_self_fails_on_invalid_license {
    not allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens", "token_id"],
        "attributes": {
            "request": {
                "http": {
                    "method": "PATCH",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as false
    with check_user_identity as true
    with check_relation as true
    with check_authorization_spicedb as true
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

test_patch_personal_access_tokens_for_self_fails_on_different_user {
    not allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens", "token_id"],
        "attributes": {
            "request": {
                "http": {
                    "method": "PATCH",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
    with check_user_identity as false
    with check_relation as true
    with check_authorization_spicedb as true
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

test_patch_personal_access_tokens_for_self_fails_on_key_of_another_user {
    not allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens", "token_id"],
        "attributes": {
            "request": {
                "http": {
                    "method": "PATCH",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
    with check_user_identity as true
    with check_relation as false
    with check_authorization_spicedb as true
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

test_patch_personal_access_tokens_for_self_fails_when_cant_contribute {
    not allow with input as {
        "parsed_path": ["api", "v1", "organizations", 1, "users", "51e63bb9-4324-487a-a680-e439540ac82e", "personal_access_tokens", "token_id"],
        "attributes": {
            "request": {
                "http": {
                    "method": "PATCH",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
    with check_user_identity as true
    with check_relation as true
    with check_authorization_spicedb as false
    with spicedb_key as "key"
    with spicedb_address as "localhost"
}

# Test allow /api/v1/personal_access_tokens/<hash> without limit
test_get_token_by_hash {
    allow with input as {
        "parsed_path": ["api", "v1", "personal_access_tokens", "token_hash"],
        "attributes": {
            "request": {
                "http": {
                    "method": "GET",
                }
            }
        },
    }
    with is_license_valid as true
}

test_get_token_by_hash_fails_with_invalid_license {
    not allow with input as {
        "parsed_path": ["api", "v1", "personal_access_tokens", "token_hash"],
        "attributes": {
            "request": {
                "http": {
                    "method": "GET",
                }
            }
        },
    }
    with is_license_valid as false
}

# Test allow /api/v1/personal_access_tokens/organization
test_get_organization_by_pat {
    allow with input as {
        "parsed_path": ["api", "v1", "personal_access_tokens", "organization"],
        "attributes": {
            "request": {
                "http": {
                    "method": "GET",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6Ijk1YTg0ZDUzMTc5OGEzMjQxMDAwOWRiMWUzOWVhNDUxMGM4NDU3NjY0Mzg5ZWJjZjYxMzJlMzRmN2Y3NDQ5ODExZWEyMzIwMDQ2NWVkMjQ2ZGEwMWEyOGQ4M2RjMGJjMjJhZjhlMjJhZTVkZDk3ZTI4YzBlMjE3ZGM5MDg0ZDk2IiwidHlwIjoiSldUIn0.eyJvd25lcl9pZCI6Ijk1ZWQ2YzFjLWQ1MDMtNGM3ZC04ZjAyLWMwZTBkYTUwODgwYyIsInJvbGVzIjpudWxsLCJ0aWQiOiIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiIxN2VlNTAzYy01MTJiLTRiYjgtYmEzNi1mMDZiZGIzMWRjNWYiLCJvcmdhbml6YXRpb25faWQiOiIxNzNkMjdjOS0yNTc4LTRkMGMtOTQwYS1hODdiOTU2YzljZTMiLCJleHRlcm5hbF90b2tlbiI6IiIsImlzX2ludGVybmFsIjoiIiwic291cmNlIjoicGF0IiwiaXNzIjoiSW50ZWwgR2V0aSIsInN1YiI6IjE3ZWU1MDNjLTUxMmItNGJiOC1iYTM2LWYwNmJkYjMxZGM1ZiIsImV4cCI6MTcyNTI4MjA2OCwibmJmIjoxNzI1Mjc4NDY4LCJpYXQiOjE3MjUyNzg0Njh9.iL-dxzZA91I8E58WKueQdNz3QcWHhHbDhOP1Eev-cjGcH7_q8I_LNgoL_qAzrx4mMGharIyoHc0P2P5KW3spk0qJfYm-S4U6NEXcRJvuDKC79Xnh2ykmUgUaC4aVdRvyjwc3Jx12ccqif1mEd4fBnZyINJe_2eKU5nFXpcbPlrwdEfa_Ud6U6aHq3UiR3c__dLC0GAc4YvScZ4V25C3Qmx2aSard5jJshEpykJAFsBtsbpJGlApVUKjfNbgXZuzkiX7VDJM-UJm-oiPYnbJmxLx8XqITqG3u43oUEw788BioDLPoxEt7cW67ZVBFdilHumcn7q7DpNAem_mUgnUdrToTGppDiMK5hSm7L3VYIrshvDTttWRaKT7OcKpzRZ4joLkI27IMAb1PwExivUpwxm_mRNca8PDtzPQbuRDlKA6owJscIcUFcpiByx5-pgHklqwxeKefunFpdYVTcJz112CcKLUohdx2YLt_sAG3o8SKp387OvhLLpDHTUpbQhW7T0eO6KWRPg_d0y1SXNKxCMXDVdNo0V_d3FULpkPXknYO9q5dA0sEV-nnqeKu4lfgdvRLLuIfkGrXxNZxPyIg0j0hS_hBH2_Eiyigv_Cw5y6hjq4Ra28Ntr0mIZdz_NWhXSLnvozLCZW6flbqWHOyZNN4ff4vr2aGUCQ8vfahbgY"
                    },
                }
            }
        },
    }
    with is_license_valid as true
}

test_get_organization_by_pat_fails_on_invalid_license {
    not allow with input as {
        "parsed_path": ["api", "v1", "personal_access_tokens", "organization"],
        "attributes": {
            "request": {
                "http": {
                    "method": "GET",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as false
}

test_get_organization_by_pat_fails_on_browser_access {
    not allow with input as {
        "parsed_path": ["api", "v1", "personal_access_tokens", "organization"],
        "attributes": {
            "request": {
                "http": {
                    "method": "GET",
                    "headers": {
                        "x-auth-request-access-token": "eyJhbGciOiJSUzUxMiIsImtpZCI6IjYxOWI0OTg2MzM5ZTgyMmFlOTM3YjNkNWFlZTJjZWY2MmE1MDA5YjM2MzQzYmE5MzY0MTVhM2MyMTNhY2FiOTRlZmExNmFhZDdhNzI0ZjNkNTk1ZmRiNjlkNDY5MTU1MDcxNWVhYWM4ZmUzMWQ3Yjg5NDJjMGE0YjY3YTZkODBlIiwidHlwIjoiSldUIn0.eyJyb2xlcyI6bnVsbCwidGlkIjoiIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwib3JnYW5pemF0aW9uX2lkIjoiYTM1MGI0NTQtY2M4MC00ZDQxLWI3MmQtMzA2MzNkNjNmMjRkIiwiZXh0ZXJuYWxfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW1OaU1XVmlNakJrTWpreU9URmhPVGd6WXpabFkyRTRaak14WXpRNVlUZGxZelF6TmpFME16VWlmUS5leUpwYzNNaU9pSm9kSFJ3Y3pvdkx6RXdMalUxTGpJMU1pNHhOVEF2WkdWNElpd2ljM1ZpSWpvaVEycHNhbUpxTURGTlYxVXlUVEpLYVU5VE1EQk5la2t3VEZSUk5FNHlSWFJaVkZrMFRVTXhiRTVFVFRWT1ZGRjNXVmROTkUxdFZYTmFSMDA1V2xob2FHSllRbk5hVTNocldYb3hkbU50WTFORVdFcHNXak5XYzFsWVNtWmtXRTVzWTI1Tklpd2lZWFZrSWpvaWQyVmlYM1ZwSWl3aVpYaHdJam94TnpBM01qazRORFE1TENKcFlYUWlPakUzTURjeU9UUXlORGtzSW1GMFgyaGhjMmdpT2lKclpWTmZUM3B6Tms0eGNpMXNhbko2V2s5WWFHVkJJaXdpWTE5b1lYTm9Jam9pU1haVVl6SjVVREF5WlUxdlRIWmxOWFpqUTNwamR5SXNJbVZ0WVdsc0lqb2lZV1J0YVc1QWMyTXRjSEp2YW1WamRDNXBiblJsYkM1amIyMGlMQ0psYldGcGJGOTJaWEpwWm1sbFpDSTZkSEoxWlN3aWJtRnRaU0k2SWpVeFpUWXpZbUk1TFRRek1qUXRORGczWVMxaE5qZ3dMV1UwTXprMU5EQmhZemd5WlNJc0luQnlaV1psY25KbFpGOTFjMlZ5Ym1GdFpTSTZJalV4WlRZelltSTVMVFF6TWpRdE5EZzNZUzFoTmpnd0xXVTBNemsxTkRCaFl6Z3laU0o5Lm5ydkF1THRmZ19hVzdtcWZFeW5Zb2FMc2xCQlVsT1lheENOU2VsNUtKOFNQZS1uV1l5dmRWREJ6RUJaRkRsU016SV9VTU5iWGhzZjJtTEd1TTA5TVZvaVpUUGNpMTcxTmpiWUdhejZHUXUyRkNybzQxejRlem9yTmVfRGEzTmE2TlFXQW5HUVZHUzZYb1JVa28xNThvLTJBamlCYnJwNlQtZ0NMRllDZUNiLVlicV8tV241Y0ZuaUxQRUtPc0thQnpqUUwwb3U2WmRqVlliR1RfX1R2Y3dCYVNxdHhFR3Q1R2tpZGtvbVFXaGVveVhuekVYSk9SVU03VDVnRHhrRV80a1R4d0hiOVZ2LWpnalJMNVFVR1luZlEwanlwYW4tRmdzdktseXBvVEZhd1V5MGhDS1lCRVpGRVBQSE1LalpnczFBWnI5eTZiZVdIYV9Yck0yWUhMZyIsInNvdXJjZSI6ImJyb3dzZXIiLCJpc3MiOiJJbnRlbCBHZXRpIiwic3ViIjoiNTFlNjNiYjktNDMyNC00ODdhLWE2ODAtZTQzOTU0MGFjODJlIiwiYXVkIjpbIndlYl91aSJdLCJleHAiOjE3MDcyOTQzMjksIm5iZiI6MTcwNzI5NDI2OSwiaWF0IjoxNzA3Mjk0MjY5fQ.hYCuEYbiTu-zajj62jwblj-XK3D4l054-SV1JG0iP8dTZKuIgJ7S1BSFgcpEpONmG_YrXlFK9yhUkYNyQMxctoDKA-XcRIQyi58Lfj87jWElEjI7mOp4l3fEuisopcKA1gdqd4jjytDqU_mi_JcBFvn_Av9xa5QSTHZ_bbUAkjv5lX0zuJS-O-c7Q43XzPeEI6MfP1tFfO6rDp-o_p_smRD647_1n_LgyNxnoL9OTO-LBZ7QZcCMh5B5PCfTJNXxlgcQL2Cep5fI-hYrA5zQO_-f7gCV5zUCKTb1KXkAHp1EAjipEm_wDK2p0Sa2tmynoOXwOu6DVHW1S7ttct-jo_v-jodwwDFmlzUcLIQ540OMtPZX2HxL-Ou0mG82b76jMwaUhwxKo9KAdBqXO_5nubQarnJLZp0fgkE7F95IqIl49GxgMyrvJh0q_ucrlJyH7x8FbxksOiwj5-rZSNE2Cd6EnZL1-MS3G_uQJc6inn7pDlxLdEvc87dJQnL3s9oarm7wI55EYvlEpexzjchLbS6YWLxYa_xVv2WVL21irPVHYeoDGdk42TFwOr4j5Hu9Kl4d-Q0sJ-1N_Gs43qsB9jAQM3FXUWix3oqyqLYtSWzZxjSyz-Hz44C1rNCkPn5VqcQEA7KgPA8aYfkpWSO0DesrL1ZOmJP7KdJm8Ttbbug"
                    },
                }
            }
        },
    }
    with is_license_valid as true
}

